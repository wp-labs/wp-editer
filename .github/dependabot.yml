version: 2

# ===========================================================================
# WarpParse Dependabot Configuration - Three-Branch Strategy
# ===========================================================================
#
# This configuration implements dependency management for three maturity levels:
#
#   alpha  â†’ Development (accepts all: -alpha, -beta, stable)
#   beta   â†’ Testing (accepts: -beta, stable; rejects: -alpha)
#   main   â†’ Production (accepts: stable only; rejects: -alpha, -beta)
#
# IMPORTANT NOTES:
#
# 1. Dependabot CANNOT filter Git dependencies by tag suffix (-alpha, -beta)
#    - All versions will create PRs regardless of branch
#    - Filtering is enforced by:
#      a) dependabot-branch-filter.yml workflow (auto-closes bad PRs)
#      b) Branch protection rules (requires status checks + reviews)
#
# 2. Each branch is configured separately with its own schedule to avoid conflicts
#
# 3. See docs/BRANCH_SOURCE_AND_MATURITY_CONTROL.md for detailed policy
#
# ===========================================================================

updates:
  # ===========================================================================
  # Alpha Branch - Development
  # ===========================================================================
  #
  # Maturity Level: Development
  # Accept: -alpha, -beta, stable (ALL versions)
  # Auto-merge: YES (all Dependabot PRs)
  # Review Required: NO
  #
  # This is the default development branch where all dependency updates are
  # accepted automatically to catch issues early.
  #
  - package-ecosystem: cargo
    directory: "/"
    target-branch: alpha
    schedule:
      interval: weekly
      day: monday
      time: "09:00"
      timezone: Asia/Shanghai
    open-pull-requests-limit: 10
    labels:
      - "ðŸ“¦ dependencies"
      - "alpha"

    groups:
      # Group wp-labs dependencies together
      wp-dependencies:
        patterns:
          - "wp-*"
        update-types:
          - "minor"
          - "patch"

      # Group external dependencies
      external-deps:
        patterns:
          - "*"
        exclude-patterns:
          - "wp-*"
        update-types:
          - "minor"
          - "patch"

    # Alpha: No ignore rules - accept everything for fast iteration

  # ===========================================================================
  # Beta Branch - Testing
  # ===========================================================================
  #
  # Maturity Level: Pre-production Testing
  # Accept: -beta, stable (NO -alpha versions)
  # Auto-close: -alpha versions (via dependabot-branch-filter workflow)
  # Auto-approve: -beta and stable versions
  # Review Required: YES (1 approval)
  #
  # Beta is for stabilization. Alpha dependencies are automatically rejected.
  # All dependency updates require manual review even if auto-approved.
  #
  - package-ecosystem: cargo
    directory: "/"
    target-branch: beta
    schedule:
      interval: weekly
      day: monday
      time: "10:00"
      timezone: Asia/Shanghai
    open-pull-requests-limit: 10
    labels:
      - "ðŸ“¦ dependencies"
      - "beta"

    groups:
      wp-dependencies:
        patterns:
          - "wp-*"
        update-types:
          - "minor"
          - "patch"

      external-deps:
        patterns:
          - "*"
        exclude-patterns:
          - "wp-*"
        update-types:
          - "minor"
          - "patch"

    # Beta: Cannot ignore by tag suffix here
    # Alpha versions will create PRs but will be auto-closed by
    # dependabot-branch-filter.yml workflow
    # See: .github/workflows/dependabot-branch-filter.yml

  # ===========================================================================
  # Main Branch - Production
  # ===========================================================================
  #
  # Maturity Level: Production
  # Accept: stable ONLY (NO -alpha or -beta versions)
  # Auto-close: -alpha and -beta versions (via dependabot-branch-filter workflow)
  # Auto-approve: stable versions only
  # Review Required: YES (2 approvals)
  #
  # Main is the production branch. Only stable, battle-tested dependencies
  # are allowed. All updates require thorough review by 2 team members.
  #
  - package-ecosystem: cargo
    directory: "/"
    target-branch: main
    schedule:
      interval: weekly
      day: monday
      time: "11:00"
      timezone: Asia/Shanghai
    open-pull-requests-limit: 5
    labels:
      - "ðŸ“¦ dependencies"
      - "stable"
      - "production"

    groups:
      wp-dependencies:
        patterns:
          - "wp-*"
        update-types:
          - "minor"
          - "patch"

      external-deps:
        patterns:
          - "*"
        exclude-patterns:
          - "wp-*"
        update-types:
          - "minor"
          - "patch"

    # Main: Cannot ignore by tag suffix here
    # Alpha and beta versions will create PRs but will be auto-closed by
    # dependabot-branch-filter.yml workflow
    # See: .github/workflows/dependabot-branch-filter.yml
    #
    # CRITICAL: Ensure branch protection rules are configured:
    # - Require 2 approvals
    # - Require status checks: Tests, filter
    # - See: docs/BRANCH_PROTECTION_RULES.md

  # ===========================================================================
  # GitHub Actions - All branches
  # ===========================================================================
  - package-ecosystem: github-actions
    directory: "/"
    target-branch: alpha
    schedule:
      interval: monthly
    open-pull-requests-limit: 5
    labels:
      - "ðŸ“¦ dependencies"
      - "ci"
