#  Performance 测试



在限速的支持下, 使处理数据不出现积压,可以控制内存的占用.



## 对比 

|      用例      | V0.6 | V0.7 | 速度变化 |
| :------------: | :--: | :--: | :------: |
| FILE2NULL-BM1  | 2.5  | 4.3  |   +72%   |
| FILE2NULL-BM2  | 9.0  | 11.0 |   +22%   |
| FILE2FILE- BM3 | 5.8  | 8.3  |   +43%   |

 

## FILE2NULL (核心解析)

不同输入输出, IO 性能不同, 为避免输入输出的影响, 提供解决核心性能测试.

输入: 标准的文件, 基于随机生成的1K 左右的数据.

输出: null . 




### BenchMark-1 : Linux ECS 

#### 机器资源: Linux 2核4G

采用第三代Intel® Xeon®可扩展处理器（Ice Lake），基频2.7 GHz，全核睿频3.5 GHz，计算性能稳定

 ESC型号: ecs.c7.large

限速 6万/S

#### 测试结果: 4.2W/S:

* 内存使用 : 160M.
* CPU使用: 190%

```
======================= wpflow sum up stat ===========================
PickStat:4.3w
+------+---------+---------+-------+
| pick | total   | success | speed |
+==================================+
| pick | 4999999 | 0       | 4.26  |
+------+---------+---------+-------+
ParsStat:4.2w
+--------------+---------+---------+----------+-------+
| rule         | total   | success | hav-rate | speed |
+=====================================================+
| @benchmark_1 | 4999992 | 2499996 | 50.0%    | 2.12  |
|--------------+---------+---------+----------+-------|
| @benchmark_2 | 4999992 | 2499996 | 50.0%    | 2.12  |
+--------------+---------+---------+----------+-------+
LoadStat:0.0w
+-----+-------+---------+----------+----------+-------+
| lib | total | success | hav_rate | suc_rate | speed |
+=====================================================+
+-----+-------+---------+----------+----------+-------+
SinkStat:
+-----------+---------------------+---------+---------+----------+-------+
| group     | sink                | total   | success | hav-rate | speed |
+========================================================================+
| benchmark |                     | 4999992 | 4999992 | 0.0%     | 4.17  |
|-----------+---------------------+---------+---------+----------+-------|
|           | benchmark_null_sink | 4999992 | 4999992 | 100.0%   | 4.17  |
|-----------+---------------------+---------+---------+----------+-------|
| default   |                     | 0       | 0       | 0.0%     | 0.00  |
|-----------+---------------------+---------+---------+----------+-------|
|           | default_sink        | 0       | 0       | 0.0%     | 0.00  |
|-----------+---------------------+---------+---------+----------+-------|
| miss      |                     | 7       | 7       | 0.0%     | 0.00  |
|-----------+---------------------+---------+---------+----------+-------|
|           | miss_sink           | 7       | 7       | 100.0%   | 0.00  |
+-----------+---------------------+---------+---------+----------+-------+
```





### BenchMark-2 : Linux ECS 

#### 机器资源: Linux 8核16G

采用第三代Intel® Xeon®可扩展处理器（Ice Lake），基频2.7 GHz，全核睿频3.5 GHz，计算性能稳定

 ESC型号: ecs.c7.2xlarge

限速 15万/S



#### 测试结果:  11W

* 内存使用 400M
* CPU 使用650%

```



======================= wpflow sum up stat ===========================
PickStat:11.0w
+------+---------+---------+-------+
| pick | total   | success | speed |
+==================================+
| pick | 9999998 | 0       | 12.82 |
+------+---------+---------+-------+
ParsStat:11.0w
+--------------+---------+---------+----------+-------+
| rule         | total   | success | hav-rate | speed |
+=====================================================+
| @benchmark_1 | 9999998 | 4999998 | 50.0%    | 6.39  |
|--------------+---------+---------+----------+-------|
| @benchmark_2 | 9999998 | 5000000 | 50.0%    | 6.39  |
+--------------+---------+---------+----------+-------+
LoadStat:0.0w
+-----+-------+---------+----------+----------+-------+
| lib | total | success | hav_rate | suc_rate | speed |
+=====================================================+
+-----+-------+---------+----------+----------+-------+
SinkStat:
+-------------+---------------------+---------+---------+----------+-------+
| group       | sink                | total   | success | hav-rate | speed |
+==========================================================================+
| benchmark_1 |                     | 4999998 | 4999998 | 0.0%     | 5.50  |
|-------------+---------------------+---------+---------+----------+-------|
|             | benchmark_null_sink | 4999998 | 4999998 | 100.0%   | 5.50  |
|-------------+---------------------+---------+---------+----------+-------|
| benchmark_2 |                     | 5000000 | 5000000 | 0.0%     | 5.50  |
|-------------+---------------------+---------+---------+----------+-------|
|             | benchmark_null_sink | 5000000 | 5000000 | 100.0%   | 5.50  |
|-------------+---------------------+---------+---------+----------+-------|
| default     |                     | 0       | 0       | 0.0%     | 0.00  |
|-------------+---------------------+---------+---------+----------+-------|
|             | default_sink        | 0       | 0       | 0.0%     | 0.00  |
|-------------+---------------------+---------+---------+----------+-------|
| miss        |                     | 0       | 0       | 0.0%     | 0.00  |
|-------------+---------------------+---------+---------+----------+-------|
|             | miss_sink           | 0       | 0       | 0.0%     | 0.00  |
|-------------+---------------------+---------+---------+----------+-------|
| monitor     |                     | 112     | 112     | 0.0%     | 0.00  |
|-------------+---------------------+---------+---------+----------+-------|
|             | monitor_sink        | 112     | 112     | 100.0%   | 0.00  |
+-------------+---------------------+---------+---------+----------+-------+
```



* 合理的限速,可以有效降低内存的使用.

## File2File 模式

### BenchMark-3 : Linux ECS 

#### 机器资源: Linux 8核16G

采用第三代Intel® Xeon®可扩展处理器（Ice Lake），基频2.7 GHz，全核睿频3.5 GHz，计算性能稳定

限速 15万/S

#### 测试结果:  8.3W

* 内存使用 400M
* CPU 使用600%

```

======================= wpflow sum up stat ===========================
PickStat:8.3w
+------+---------+---------+-------+
| pick | total   | success | speed |
+==================================+
| pick | 4999999 | 0       | 10.17 |
+------+---------+---------+-------+
ParsStat:8.3w
+--------------+---------+---------+----------+-------+
| rule         | total   | success | hav-rate | speed |
+=====================================================+
| @benchmark_1 | 4999999 | 2499999 | 50.0%    | 4.77  |
|--------------+---------+---------+----------+-------|
| @benchmark_2 | 4999999 | 2500000 | 50.0%    | 4.77  |
+--------------+---------+---------+----------+-------+
LoadStat:0.0w
+-----+-------+---------+----------+----------+-------+
| lib | total | success | hav_rate | suc_rate | speed |
+=====================================================+
+-----+-------+---------+----------+----------+-------+
SinkStat:
+-------------+---------------------+---------+---------+----------+-------+
| group       | sink                | total   | success | hav-rate | speed |
+==========================================================================+
| benchmark_1 |                     | 2499999 | 2499999 | 0.0%     | 4.16  |
|-------------+---------------------+---------+---------+----------+-------|
|             | benchmark_file_sink | 2499999 | 2499999 | 100.0%   | 4.16  |
|-------------+---------------------+---------+---------+----------+-------|
| benchmark_2 |                     | 2500000 | 2500000 | 0.0%     | 4.16  |
|-------------+---------------------+---------+---------+----------+-------|
|             | benchmark_file_sink | 2500000 | 2500000 | 100.0%   | 4.16  |
|-------------+---------------------+---------+---------+----------+-------|
| default     |                     | 0       | 0       | 0.0%     | 0.00  |
|-------------+---------------------+---------+---------+----------+-------|
|             | default_sink        | 0       | 0       | 0.0%     | 0.00  |
|-------------+---------------------+---------+---------+----------+-------|
| miss        |                     | 0       | 0       | 0.0%     | 0.00  |
|-------------+---------------------+---------+---------+----------+-------|
|             | miss_sink           | 0       | 0       | 0.0%     | 0.00  |
|-------------+---------------------+---------+---------+----------+-------|
| monitor     |                     | 64      | 64      | 0.0%     | 0.00  |
|-------------+---------------------+---------+---------+----------+-------|
|             | monitor_sink        | 64      | 64      | 100.0%   | 0.00  |
```





## SYSLOG2NULL 模式

测试需要调整UDP 的数据窗口.



## Kafka2NULL 模式